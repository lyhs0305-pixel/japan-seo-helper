<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>旅行商品內容作成支援工具</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    body { background-color: #F9F9F7; font-family: 'Noto Sans JP', sans-serif; color: #333; }
    .lang-sub { color: #999; font-size: 10px; margin-left: 4px; }
    .preview-label { font-size: 10px; color: #6A8D92; font-weight: 700; letter-spacing: 0.2em; text-transform: uppercase; }
    .input-card { background: white; border: 1px solid #eee; padding: 16px; border-radius: 4px; margin-top: 12px; }
    input[type="radio"] { accent-color: #6A8D92; }
    .sticky-preview { position: sticky; top: 2rem; height: calc(100vh - 4rem); overflow-y: auto; }
  </style>
</head>

<body class="p-6 md:p-12">
<div class="max-w-[1440px] mx-auto">

<header class="mb-10">
  <h1 class="text-xl font-medium tracking-widest text-[#2B2B2B]">
    旅行商品內容作成支援
    <span class="text-xs font-normal text-gray-400 ml-2">Travel Content Support</span>
  </h1>
</header>

<div class="grid grid-cols-1 lg:grid-cols-[420px_1fr] gap-10">

<section class="space-y-6 bg-white p-6 rounded-lg border border-gray-200">

  <div>
    <p class="text-[13px] font-bold mb-3">商品類別 <span class="lang-sub">種別</span></p>
    <div class="grid grid-cols-2 gap-2 text-[12px]">
      <label class="flex items-center gap-2 p-2 border rounded"><input type="radio" checked>包車</label>
      <label class="flex items-center gap-2 p-2 border rounded"><input type="radio">票券</label>
      <label class="flex items-center gap-2 p-2 border rounded"><input type="radio">體驗</label>
      <label class="flex items-center gap-2 p-2 border rounded"><input type="radio">多日遊</label>
    </div>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <p class="text-[13px] font-bold mb-2">對象客群</p>
      <select id="marketSelect" class="w-full border-b text-[13px] py-1 bg-transparent">
        <option>日本人</option>
        <option>中華圈</option>
        <option>英語圈</option>
      </select>
    </div>
    <div>
      <p class="text-[13px] font-bold mb-2">方案數量</p>
      <select id="planCountSelect" class="w-full border-b text-[13px] py-1 bg-transparent">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
      </select>
    </div>
  </div>

  <div>
    <p class="text-[13px] font-bold mb-2">商品情報</p>
    <textarea id="sourceInfo" class="w-full h-32 border bg-gray-50 text-[12px] p-3 rounded"></textarea>
  </div>

  <div id="dynamicInputsContainer"></div>

  <button id="generateBtn" onclick="generateAIContent()"
    class="w-full bg-[#2B2B2B] text-white py-4 rounded font-bold">
    生成 AI 優化內容
  </button>

</section>

<section class="bg-white p-10 border rounded sticky-preview">
  <div class="space-y-6">
    <div>
      <p class="preview-label">Product Title</p>
      <p id="res-title-zh">等待生成...</p>
      <p id="res-title-ja" class="text-sm text-gray-400"></p>
    </div>

    <div>
      <p class="preview-label">Catch Copy</p>
      <p id="res-summary-zh"></p>
      <p id="res-summary-ja" class="text-sm text-gray-400"></p>
    </div>

    <div>
      <p class="preview-label">Description</p>
      <p id="res-desc-zh"></p>
      <p id="res-desc-ja" class="text-sm text-gray-400"></p>
    </div>

    <div id="planPreviewContainer"></div>
  </div>
</section>

</div>
</div>

<script>
const planCountSelect = document.getElementById('planCountSelect');
const dynamicInputsContainer = document.getElementById('dynamicInputsContainer');

function updateInputFields() {
  dynamicInputsContainer.innerHTML = '';
  for (let i = 1; i <= planCountSelect.value; i++) {
    dynamicInputsContainer.innerHTML += `
      <div class="input-card">
        <input class="plan-name w-full border-b mb-2" placeholder="方案名稱">
        <textarea class="plan-desc w-full border p-2" placeholder="方案說明"></textarea>
      </div>`;
  }
}
updateInputFields();
planCountSelect.addEventListener('change', updateInputFields);

async function generateAIContent() {
  const workerUrl = "https://travel-content-generator.lyhs0305.workers.dev/";
  const sourceInfo = sourceInfo.value;
  if (!sourceInfo) return alert("請填寫商品資訊");

  const plans = [...document.querySelectorAll('.input-card')].map((c, i) =>
    `方案${i+1}: ${c.querySelector('.plan-name').value} - ${c.querySelector('.plan-desc').value}`
  ).join("\n");

  const finalPrompt = `
請生成 JSON：
${sourceInfo}
${plans}
格式：
{"title_zh":"","title_ja":"","summary_zh":"","summary_ja":"","desc_zh":"","desc_ja":"","plans":[{"name_zh":"","name_ja":"","desc_zh":"","desc_ja":""}]}
`;

  try {
    const response = await fetch(workerUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-API-Key": "dontuse-ai-frontend-2025-9xA7kP3mQ"
      },
      body: JSON.stringify({ prompt: finalPrompt })
    });

    const result = await response.json();   // ✅ 關鍵行
    const aiData = JSON.parse(result.text); // ✅ 正確解析

    document.getElementById('res-title-zh').innerText = aiData.title_zh;
    document.getElementById('res-title-ja').innerText = aiData.title_ja;
    document.getElementById('res-summary-zh').innerText = aiData.summary_zh;
    document.getElementById('res-summary-ja').innerText = aiData.summary_ja;
    document.getElementById('res-desc-zh').innerText = aiData.desc_zh;
    document.getElementById('res-desc-ja').innerText = aiData.desc_ja;

    const container = document.getElementById('planPreviewContainer');
    container.innerHTML = '';
    aiData.plans.forEach(p => {
      container.innerHTML += `<div><b>${p.name_zh}</b><br>${p.desc_zh}</div>`;
    });

  } catch (e) {
    console.error(e);
    alert("生成失敗，請檢查 Worker");
  }
}
</script>

</body>
</html>
